import{d as ce,f as w,Y as x,b1 as D,a0 as $,a as pe,s as K,r as g,h as he,B as fe,A as ge,o as m,c as S,b as e,w as t,e as u,D as k,u as s,a7 as q,a6 as _,aE as N,H as E,a2 as Y,at as ve,F as Q,k as W,x as j,j as I,au as me,ar as _e,av as ye,a9 as Ve,aq as Z,t as v,ag as Ae,a1 as be,T as ke,ao as we,aw as Ce,aX as ee,a8 as xe,I as De,m as f,M as $e,N as Se,q as Te,V as Ue,p as z,v as M}from"./index.d08b3963.js";import{u as te}from"./user.35ce0bfe.js";import{u as ae}from"./index.f137f2c7.js";import"./filedownloader.f3cc1d55.js";import"./country.cb4beb97.js";const le=ce("alert",{state:()=>({loading:!1,dialog:!1,alerts:[],alert:{title:"",body:"",target_user:"",dispatched_at:"",channels:[],users:[]},time:""}),getters:{},actions:{async getAlerts(d=1,r="",c="",n=""){const{notify:h}=$(),i=w();this.loading=!0;try{await x.get(D+"?page="+d+"&filter[status]="+r.toLowerCase()+"&filter[target_user]="+c.toLowerCase()+"&filter[dispatch_date]="+n+"&include=creator",{headers:{Accept:"application/json",Authorization:`Bearer ${i.token}`}}).then(p=>{this.alerts=p.data.data.alerts,this.loading=!1})}catch(p){this.loading=!1,h({title:"An Error Occurred",text:p.response.data.message,type:"error"})}},async singleAlerts(d){const{notify:r}=$(),c=w();this.loading=!0;try{await x.get(`${D}/${d}`,{headers:{Accept:"application/json",Authorization:`Bearer ${c.token}`}}).then(n=>{this.alert=n.data.data.alert,this.loading=!1})}catch(n){this.loading=!1,r({title:"An Error Occurred",text:n.response.data.message,type:"error"})}},async createAlert(d){const{notify:r}=$(),c=w();this.loading=!0;var n=new FormData;n.append("title",d.title),n.append("body",d.body),n.append("target_user",d.target_user.toLowerCase()),n.append("dispatch_datetime",d.dispatched_at+" "+this.time);const h=d.channels,i=d.users;for(let p=0;p<h.length;p++)n.append("channels[]",h[p]);for(let p=0;p<i.length;p++)n.append("users[]",i[p]);try{await x.post(D,n,{headers:{Accept:"application/json",Authorization:`Bearer ${c.token}`}}).then(p=>{this.dialog=!1,this.alert=Object.assign({},{title:"",body:"",target_user:"",dispatched_at:"",channels:[],users:[]}),this.getAlerts(),this.loading=!1})}catch(p){this.loading=!1,r({title:"An Error Occurred",text:p.response.data.message,type:"error"})}},async updateAlert(d){const{notify:r}=$(),c=w();this.loading=!0;var n=new FormData;n.append("title",d.title),d.body&&n.append("body",d.body),n.append("target_user",d.target_user.toLowerCase()),n.append("dispatch_datetime",d.dispatched_at+" "+this.time),n.append("_method","PATCH");try{await x.post(D+"/"+d.id,n,{headers:{Accept:"application/json",Authorization:`Bearer ${c.token}`}}).then(h=>{this.getAlerts(),this.loading=!1,this.dialog=!1})}catch(h){this.loading=!1,r({title:"An Error Occurred",text:h.response.data.message,type:"error"})}},async deleteAlert(d){const{notify:r}=$(),c=w();this.loading=!0;try{await x.delete(D+"/"+d,{headers:{Accept:"application/json",Authorization:`Bearer ${c.token}`}}).then(n=>{this.getAlerts(),this.loading=!1})}catch(n){this.loading=!1,r({title:"An Error Occurred",text:n.response.data.message,type:"error"})}},async restoreAlert(d){const{notify:r}=$(),c=w();this.loading=!0;try{await x.patch(D+"/"+d+"/restore","",{headers:{Accept:"application/json",Authorization:`Bearer ${c.token}`}}).then(n=>{this.getAlerts(),this.loading=!1})}catch(n){this.loading=!1,r({title:"An Error Occurred",text:n.response.data.message,type:"error"})}},async dispatchAlert(d){const{notify:r}=$(),c=w();this.loading=!0;try{await x.post(D+"/"+d+"/dispatch","",{headers:{Accept:"application/json",Authorization:`Bearer ${c.token}`}}).then(n=>{this.getAlerts(),this.loading=!1})}catch(n){this.loading=!1,r({title:"An Error Occurred",text:n.response.data.message,type:"error"})}}}});const je={class:"d-flex align-center justify-space-between w-100"},Be=u("h4",null,"Filter Options:",-1),Fe=f("Reset"),Oe=f("Filter"),qe={class:"d-flex align-center justify-space-between mb-6"},Ee=u("h3",null,"All Annoucement",-1),ze=f("Send email"),Me=f("Send in app"),Le=f("Send push"),Ne={key:0},Ye={class:"font-weight-bold"},Ie={class:"font-weight-bold"},Pe=f(" Edit Alert "),Re=f(" Restore Alert "),He=f(" Delete Alert "),Xe=f(" Dispatch Alert "),Ge={key:1,class:"text-center py-6"},Je={class:"d-flex align-center w-100 justify-space-between pa-7"},Ke={class:"text-h5 font-weight-bold"},Qe=f(" Close "),st=pe({__name:"annoucements",setup(d){w();const r=le(),{loading:c,alerts:n,dialog:h,alert:i,time:p}=K(le()),{getUsersByEmailAndId:We,search_users:se}=K(te()),{getUsers:ne,searchUsers:oe}=te();g();const re=g([{title:"No."},{title:"Title"},{title:"Creator"},{title:"Target user"},{title:"Target user count"},{title:"Date created"},{title:"Dispatched Date"},{title:"Status"},{title:"Actions"}]);g("");const y=g(1),V=g(""),A=g(""),b=g("");he(async()=>{await r.getAlerts(y.value,V.value,b.value,A.value),await ne(1)});const B=g(""),P=fe({get(){return B.value},set(C){return C=="email"?"email":C=="in_app"?"in_app":"push"}});ge(P,()=>i.value.channels=[P.value]);const de=async()=>{y.value=1,V.value="",b.value="",A.value="",await r.getAlerts(y.value,V.value,b.value,A.value)},ie=C=>C=="pending"?"yellow-darken-3":C=="ongoing"?"light-green-darken-2":"green lighten-3",F=g(!1),O=g("Create Alert"),ue=()=>{O.value="Update Alert",h.value=!0,F.value=!0},R=C=>{h.value=!1,i.value=Object.assign({},{title:"",body:"",target_user:"",dispatched_at:"",channels:[],users:[]}),O.value="Create Alert",F.value=!1},H=g(new Date().toISOString().slice(0,10));return(C,a)=>{var X;return m(),S("div",null,[e(Y,{flat:"",class:"my-4 pa-4",rounded:"0"},{default:t(()=>[u("div",je,[Be,u("div",null,[e(k,{onClick:de,width:"200px",class:"mr-4"},{default:t(()=>[Fe]),_:1}),e(k,{onClick:a[0]||(a[0]=o=>s(r).getAlerts(y.value,V.value,b.value,A.value)),width:"200px",color:"secondary"},{default:t(()=>[Oe]),_:1})])]),e(q,{class:"mt-3"},{default:t(()=>[e(_,{cols:"12",sm:"6",md:"4"},{default:t(()=>[e(N,{label:"Filter by Status",modelValue:V.value,"onUpdate:modelValue":a[1]||(a[1]=o=>V.value=o),density:"compact",items:["Pending","Successful","Ongoing"],variant:"outlined"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:t(()=>[e(N,{modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=o=>b.value=o),label:"Filter by target user",density:"compact",items:["All","Verified","Specific"],variant:"outlined"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:t(()=>[e(E,{modelValue:A.value,"onUpdate:modelValue":a[3]||(a[3]=o=>A.value=o),type:"date",label:"Filter dispatched date",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Y,{class:"pa-7"},{default:t(()=>{var o;return[u("div",qe,[Ee,u("div",null,[e(k,{color:"secondary","prepend-icon":"mdi-email",onClick:a[4]||(a[4]=T=>{h.value=!0,B.value="email"})},{default:t(()=>[ze]),_:1}),e(k,{color:"secondary","prepend-icon":"mdi-apps",onClick:a[5]||(a[5]=T=>{h.value=!0,B.value="in_app"}),class:"ml-2"},{default:t(()=>[Me]),_:1}),e(k,{color:"secondary","prepend-icon":"mdi-bell-ring-outline",onClick:a[6]||(a[6]=T=>{h.value=!0,B.value="push"}),class:"ml-2"},{default:t(()=>[Le]),_:1})])]),e(ve,{class:"my-4"},{default:t(()=>{var T;return[u("thead",null,[u("tr",null,[(m(!0),S(Q,null,W(re.value,(l,L)=>(m(),S("th",{key:L,class:"text-left font-weight-bold"},v(l.title),1))),128))])]),s(c)==!1&&((T=s(n).data)==null?void 0:T.length)>0?(m(),S("tbody",Ne,[(m(!0),S(Q,null,W(s(n).data,(l,L)=>{var G,J;return m(),S("tr",{key:l==null?void 0:l.id},[u("td",null,v(L+1),1),u("td",Ye,v(l==null?void 0:l.title),1),u("td",Ie,v((G=l==null?void 0:l.creator)==null?void 0:G.email),1),u("td",null,v(l==null?void 0:l.target_user),1),u("td",null,v((J=l==null?void 0:l.target_user_count)!=null?J:"No data"),1),u("td",null,v(s(ae)(l==null?void 0:l.created_at,"DD, MMM YYYY - hh:mm a").value),1),u("td",null,v(s(ae)(l==null?void 0:l.dispatched_at,"DD, MMM YYYY - hh:mm a").value),1),u("td",null,[e($e,{label:"",class:"pa-2 text-capitalize",color:ie(l==null?void 0:l.status)},{default:t(()=>[f(v(l==null?void 0:l.status),1)]),_:2},1032,["color"])]),u("td",null,[e(q,{justify:"center"},{default:t(()=>[e(Se,{transition:"scroll-x-transition"},{activator:t(({props:U})=>[e(k,Te({text:"",icon:"mdi-dots-vertical",color:"transparent",class:"ma-2"},U),null,16)]),default:t(()=>[e(Ue,null,{default:t(()=>[e(z,{onClick:U=>{ue(),s(r).singleAlerts(l==null?void 0:l.id)},link:"",color:"secondary"},{default:t(()=>[e(M,null,{default:t(()=>[Pe]),_:1})]),_:2},1032,["onClick"]),e(z,{onClick:U=>s(r).restoreAlert(l==null?void 0:l.id),link:"",color:"secondary"},{default:t(()=>[e(M,null,{default:t(()=>[Re]),_:1})]),_:2},1032,["onClick"]),e(z,{onClick:U=>s(r).deleteAlert(l==null?void 0:l.id),link:"",color:"secondary"},{default:t(()=>[e(M,null,{default:t(()=>[He]),_:1})]),_:2},1032,["onClick"]),e(z,{onClick:U=>s(r).dispatchAlert(l==null?void 0:l.id),link:"",color:"secondary"},{default:t(()=>[e(M,null,{default:t(()=>[Xe]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])])}),128))])):j("",!0)]}),_:1}),s(c)==!0?(m(),I(_e,{key:0,class:"align-center justify-center w-100 my-5"},{default:t(()=>[e(me,{indeterminate:""})]),_:1})):j("",!0),s(c)==!1&&((o=s(n))==null?void 0:o.length)<=0?(m(),S("p",Ge," No data available ")):j("",!0)]}),_:1}),e(ye,{modelValue:y.value,"onUpdate:modelValue":[a[7]||(a[7]=o=>y.value=o),a[10]||(a[10]=o=>s(r).getAlerts(y.value,V.value,b.value,A.value))],length:(X=s(n))==null?void 0:X.last_page,onNext:a[8]||(a[8]=o=>s(r).getAlerts(y.value,V.value,b.value,A.value)),onPrev:a[9]||(a[9]=o=>s(r).getAlerts(y.value,V.value,b.value,A.value)),"active-color":"red",start:1,variant:"flat",class:"mt-5",color:"bg-secondary",rounded:"circle"},null,8,["modelValue","length"]),e(q,{justify:"center"},{default:t(()=>[e(Ve,{modelValue:s(h),"onUpdate:modelValue":a[20]||(a[20]=o=>Z(h)?h.value=o:null),"max-width":"500px"},{default:t(()=>[e(Y,null,{default:t(()=>[u("div",Je,[u("h3",Ke,v(O.value),1),e(k,{onClick:R,color:"secondary",variant:"outlined",icon:"mdi-close"},{default:t(()=>[e(Ae,{icon:"mdi-close"})]),_:1})]),e(be,null,{default:t(()=>[e(ke,null,{default:t(()=>[e(we,{"lazy-validation":""},{default:t(()=>[e(q,null,{default:t(()=>[e(_,{cols:"12",sm:"6",md:"12"},{default:t(()=>[e(E,{modelValue:s(i).title,"onUpdate:modelValue":a[11]||(a[11]=o=>s(i).title=o),variant:"outlined",label:"Title*",required:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(Ce,{modelValue:s(i).body,"onUpdate:modelValue":a[12]||(a[12]=o=>s(i).body=o),variant:"outlined",label:"body*",required:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"12"},{default:t(()=>[e(N,{modelValue:s(i).target_user,"onUpdate:modelValue":a[13]||(a[13]=o=>s(i).target_user=o),variant:"outlined",label:"Target user*",required:"",items:["All","Verified","Specific"]},null,8,["modelValue"])]),_:1}),s(i).target_user=="Specific"?(m(),I(_,{key:0,cols:"12",sm:"12"},{default:t(()=>[e(ee,{items:s(se),label:"Users*",required:"",onInput:a[14]||(a[14]=o=>s(oe)(o.target.value)),modelValue:s(i).users,"onUpdate:modelValue":a[15]||(a[15]=o=>s(i).users=o),modelModifiers:{lazy:!0},multiple:"","item-title":"email","item-value":"id",clearable:"",hint:"This field is required","persistent-hint":""},null,8,["items","modelValue"])]),_:1})):j("",!0),e(_,{cols:"12",sm:"12"},{default:t(()=>[e(E,{type:"date",min:H.value,hint:"Dispatch date and time must be a date after or equal to now + 5 minutes","persistent-hint":"",label:"Dispatch datetime",placeholder:"Dispatch datetime",modelValue:s(i).dispatched_at,"onUpdate:modelValue":a[16]||(a[16]=o=>s(i).dispatched_at=o),variant:"outlined"},null,8,["min","modelValue"])]),_:1}),e(_,{cols:"12",sm:"12"},{default:t(()=>[e(E,{type:"time",min:H.value,hint:"Dispatch date and time must be a date after or equal to now + 5 minutes","persistent-hint":"",label:"Dispatch time",placeholder:"Dispatch datetime",modelValue:s(p),"onUpdate:modelValue":a[17]||(a[17]=o=>Z(p)?p.value=o:null),variant:"outlined"},null,8,["min","modelValue"])]),_:1}),F.value==!0?(m(),I(_,{key:1,cols:"12",sm:"12"},{default:t(()=>[e(ee,{items:["email","in_app","push"],label:"Channels*",required:"",multiple:"",modelValue:s(i).channels,"onUpdate:modelValue":a[18]||(a[18]=o=>s(i).channels=o),"item-title":"name","item-value":"id",hint:"This field is required","persistent-hint":""},null,8,["modelValue"])]),_:1})):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(xe,null,{default:t(()=>[e(De),e(k,{color:"secondary",class:"px-7",variant:"outlined",onClick:R},{default:t(()=>[Qe]),_:1}),e(k,{loading:s(c),onClick:a[19]||(a[19]=o=>F.value==!0?s(r).updateAlert(s(i)):s(r).createAlert(s(i))),color:"secondary",class:"px-12",variant:"flat"},{default:t(()=>[f(v(O.value),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}});export{st as default};
