import{d as h,f as c,Y as l,aU as p,aV as f,aD as u,a0 as d}from"./index.d08b3963.js";import{d as y}from"./filedownloader.f3cc1d55.js";import"./country.cb4beb97.js";const _=h("giftcard",{state:()=>({giftCard:{name:"",icon:null,sale_term:"",countries:[],data:"",admins:[]},loading:!1,declining:!1,approving:!1,gift_categories:[],dialog:!1,dialog2:!1,dialog3:!1,singleGiftCard:{},gift_transactions:[],singleGiftCardTransaction:{cards:[]},singleGiftcardUnit:0,relatedGiftCards:[],update_category:!1,update_admin:!1,page:1,tab:null,status:""}),getters:{country_id:t=>{var a;return(a=t.giftCard.countries)==null?void 0:a.map(r=>r.id?r.id:r)},admin_id:t=>{var a;return(a=t.giftCard.admins)==null?void 0:a.map(r=>r.id?r.id:r)}},actions:{async getAllGifCardCategories(t=1,a="",r="",e=""){const{notify:s}=d(),n=c();this.loading=!0;try{await l.get(p+"?include=countries&sort=name&per_page=50&page="+t+"&filter[name]="+a+"&filter[sale_activated]="+r+"&filter[purchase_activated]="+e,{headers:{Accept:"application/json",Authorization:`Bearer ${n.token}`}}).then(o=>{this.gift_categories=o.data.data.giftcard_categories,this.loading=!1})}catch(o){this.loading=!1,s({title:"An Error Occurred",text:o.response.data.message,type:"error"})}},async giftCardTransactionQueries(t,a=1){const r=c();return await l.get(f+`?per_page=100&include=user,giftcardProduct&filter[status]=${t}&page=${a}`,{headers:{Accept:"application/json",Authorization:`Bearer ${r.token}`}})},async getAllGiftCardTransaction(t,a="",r=1,e="",s="",n=" "){const{notify:o}=d(),i=c();this.loading=!0;try{await l.get(f+`?per_page=50&include=user,giftcardProduct&status=${t}${n?`&filter[reference]=${n}`:""}${a?`&filter[trade_type]=${a.toLowerCase()}`:""}&page=${r}${e||s?`&filter[creation_date]=${e}${s!==""?","+s:""}`:""}`,{headers:{Accept:"application/json",Authorization:`Bearer ${i.token}`}}).then(g=>{this.gift_transactions=g.data.data.giftcards,this.loading=!1})}catch(g){this.loading=!1,o({title:"An Error Occurred",text:g.response.data.message,type:"error"})}},async getAllGiftCardTransactionByUserId(t){const{notify:a}=d(),r=c();this.loading=!0;try{await l.get(`${f}/${t}?include=user,bank,giftcardProduct,reviewer`,{headers:{Accept:"application/json",Authorization:`Bearer ${r.token}`}}).then(e=>{this.singleGiftCardTransaction=e.data.data.giftcard,this.singleGiftcardUnit=e.data.data.related_giftcards.length,this.relatedGiftCards=e.data.data.related_giftcards,this.loading=!1})}catch(e){this.loading=!1,a({title:"An Error Occurred",text:e.response.data.message,type:"error"})}},async filterAllGiftCardTransactionByUserId(t,a=1){const{notify:r}=d(),e=c();this.loading=!0;try{await l.get(`${f}?filter[user_id]=${t}&include=user,bank,giftcardProduct&page=${a}&per_page=20`,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(s=>{this.gift_transactions=s.data.data.giftcards,this.loading=!1})}catch(s){this.loading=!1,r({title:"An Error Occurred",text:s.response.data.message,type:"error"})}},async approveRequest(t,a,r=!0){const e=c(),{notify:s}=d();this.approving=!0;var n=new FormData;n.append("complete_approval","1"),n.append("_method","PATCH");try{await l.post(f+"/"+t+`${r?"/approve":"/approve/all"}`,n,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(o=>{this.approving=!1,this.dialog=!1,s({title:"Approved Successfully",text:o.data.message,type:"success"}),this.getAllGiftCardTransactionByUserId(t)})}catch(o){this.approving=!1,s({title:"An Error Occurred",text:o.response.data.message,type:"error"})}},async partialApproveRequest(t,a,r=!0){console.log(a);const e=c();u();const{notify:s}=d();this.approving=!0;var n={...a,_method:"PATCH",complete_approval:"0"};try{await l.post(f+"/"+t+`${r?"/approve":"/approve/all"}`,n,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(o=>{this.approving=!1,this.dialog=!1,this.dialog2=!1,this.dialog3=!1,this.getAllGiftCardTransactionByUserId(t),s({title:"Approved Successfully",text:o.data.message,type:"success"})})}catch(o){this.approving=!1,this.dialog=!1,s({title:"An Error Occurred",text:o.response.data.message,type:"error"})}},async declineRequest(t,a,r,e=!0){const s=c(),{notify:n}=d();this.declining=!0;let o={_method:"PATCH",review_note:a,review_proof:r};try{await l.post(f+"/"+t+`${e?"/decline":"/decline/all"}`,o,{headers:{Accept:"application/json",Authorization:`Bearer ${s.token}`}}).then(i=>{this.declining=!1,this.dialog=!1,this.dialog2=!1,this.dialog3=!1,n({title:"Declined Successfully",text:i.data.message,type:"success"}),this.getAllGiftCardTransactionByUserId(t)})}catch(i){this.declining=!1,n({title:"An Error Occurred",text:i.response.data.message,type:"error"})}},async getSingleGifCardCategories(t){const{notify:a}=d(),r=c();try{await l.get(p+"/"+t+"?include=countries,admins",{headers:{Accept:"application/json",Authorization:`Bearer ${r.token}`}}).then(e=>{this.singleGiftCard=e.data.data.giftcard_category})}catch(e){a({title:"An Error Occurred",text:e.response.data.message,type:"error"})}},async deleteGifCardCategories(t){if(confirm("Are you sure you want to delete this gift card Item?")){const{notify:a}=d(),r=c();try{await l.delete(p+"/"+t,{headers:{Accept:"application/json",Authorization:`Bearer ${r.token}`}}).then(e=>{a({title:"Successful",text:"Item deleted successfully",type:"success"}),this.getAllGifCardCategories()})}catch(e){a({title:"An Error Occurred",text:e.response.data.message,type:"error"})}}},async restoreGifCardCategories(t){if(confirm("Are you sure you want to restore this gift card Item?")){const{notify:a}=d(),r=c();try{await l.patch(p+"/"+t+"/restore","",{headers:{Accept:"application/json",Authorization:`Bearer ${r.token}`}}).then(e=>{a({title:"Successful",text:"Item restored successfully",type:"success"}),this.getSingleGifCardCategories(t)})}catch(e){a({title:"An Error Occurred",text:e.response.data.message,type:"error"})}}},async activationGifCardCategories(t){const{notify:a}=d(),r=c();try{await l.patch(p+"/"+t+"/sale-activation","",{headers:{Accept:"application/json",Authorization:`Bearer ${r.token}`}}).then(e=>{a({title:"Successful",text:e.data.message,type:"success"}),this.getSingleGifCardCategories(t)})}catch(e){a({title:"An Error Occurred",text:e.response.data.message,type:"error"})}},async purchaseActivationGifCardCategories(t){const{notify:a}=d(),r=c();try{await l.patch(p+"/"+t+"/purchase-activation","",{headers:{Accept:"application/json",Authorization:`Bearer ${r.token}`}}).then(e=>{a({title:"Successful",text:e.data.message,type:"success"}),this.getSingleGifCardCategories(t)})}catch(e){a({title:"An Error Occurred",text:e.response.data.message,type:"error"})}},async createGiftCardCategory(t){const a=c(),{notify:r}=d();let e=t.icon;var s=new FormData;s.append("name",t.name),s.append("icon",e),s.append("sale_term",t.sale_term);const n=this.country_id,o=this.admin_id;for(let i=0;i<n.length;i++)s.append("countries[]",n[i]);for(let i=0;i<o.length;i++)s.append("admins[]",o[i]);this.loading=!0;try{await l.post(p,s,{headers:{Accept:"application/json",Authorization:`Bearer ${a.token}`}}).then(i=>{this.loading=!1,r({title:"Successful",text:i.data.message,type:"success"}),this.dialog=!1,this.getAllGifCardCategories()})}catch(i){this.loading=!1,r({title:"An Error Occurred",text:i.response.data.message,type:"error"})}},async editGiftCardCategory(t){const a=c(),{notify:r}=d();console.log(t.countries);let e=t.icon;var s=new FormData;s.append("name",t.name),e.name&&s.append("icon",e,e.name),t!=null&&t.sale_term&&s.append("sale_term",t==null?void 0:t.sale_term);const n=this.country_id;if((n==null?void 0:n.length)>0&&this.update_category)for(let i=0;i<n.length;i++)s.append("countries[]",n[i]);const o=this.admin_id;if((o==null?void 0:o.length)>0&&this.update_admin)for(let i=0;i<o.length;i++)s.append("admins[]",o[i]);s.append("_method","PATCH"),this.loading=!0;try{await l.post(p+"/"+t.id,s,{headers:{Accept:"application/json",Authorization:`Bearer ${a.token}`}}).then(i=>{this.loading=!1,r({title:"Successful",text:i.data.message,type:"success"}),this.dialog=!1,this.update_admin=!1,this.update_category=!1,this.getAllGifCardCategories()})}catch(i){this.loading=!1,r({title:"An Error Occurred",text:i.response.data.message,type:"error"})}},async exportGiftcards(){var n;let a=0,r=Math.ceil(((n=this.gift_transactions)==null?void 0:n.total)/5e3);const e=c(),{notify:s}=d();s({title:"Export",text:"Preparing file to export",type:"info"});try{for(;r--;)await l.get(f+`/export?limit=${5e3}&offset=${a}`,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(o=>{y(o.data.data.path,"file downloaded")}),a++;s({title:"Successful",text:"Giftcards exported successfully",type:"success"})}catch(o){this.loading=!1,console.log(o)}}}});export{_ as u};
