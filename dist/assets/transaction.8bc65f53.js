import{a as qe,s as se,f as Le,r as p,ai as ze,h as Me,as as Ye,A as Oe,o as u,c as d,b as l,w as t,a2 as R,ad as He,ay as Qe,a1 as pe,m as _,t as i,a8 as We,I as Je,D as A,a9 as ne,e as o,u as s,j as F,a6 as $,O as Q,a7 as W,x as v,H as J,aE as Ke,aj as Xe,aq as B,ak as z,at as Ze,F as M,k as K,aT as el,au as ll,ar as tl,av as al,ag as ol,ao as sl,aw as _e,ax as nl,T as rl,i as ul,M as dl,N as il,q as cl,V as pl,p as X,v as Z}from"./index.d08b3963.js";import{u as fe,_ as ve,a as ye,b as me}from"./uploadImage.fc51e473.js";import{u as ge}from"./giftcard.f59d4277.js";import{u as he}from"./withdrawals.090f5e86.js";import{u as _l}from"./index.f137f2c7.js";import"./filedownloader.f3cc1d55.js";import"./country.cb4beb97.js";const fl=_(" Confirm "),vl=_("Cancel"),gl=_("Yes"),hl={class:"d-flex justify-space-between"},yl=o("h3",null,"Giftcard Transactions",-1),ml=_("Export"),bl=o("div",{class:""},[o("h4",null,"Total Earnings")],-1),xl={key:0,class:"mt-11"},kl={class:"mb-2"},wl=o("span",null,"All time",-1),Vl={key:1},Cl={class:"ml-16 d-flex align-center justify-space-between w-100"},Tl={class:"d-flex align-start justify-start flex-column w-100"},Al={key:0,class:"pl-3 my-5"},Ul={class:"mb-2"},Dl=o("span",null,"Successful",-1),Fl={key:1},jl={class:"d-flex align-start justify-start flex-column w-100 flex-grow-1"},Il={key:0,class:"pl-3 my-5"},Pl={class:"mb-2"},Rl=o("span",null,"Pending",-1),$l={key:1},Nl={class:"d-flex align-start justify-start flex-column w-100 flex-grow-1"},Sl={key:0,class:"pl-3 my-5"},El={class:"mb-2"},Gl=o("span",null,"Failed",-1),Bl={key:1},ql={class:"d-flex align-start justify-start flex-column w-100 flex-grow-1"},Ll={key:0,class:"pl-3 my-5"},zl={class:"mb-2"},Ml=o("span",null,"Partial",-1),Yl={key:1},Ol={class:"d-flex align-center justify-space-between w-100"},Hl=o("h4",null,"Filter Options:",-1),Ql=_("Reset"),Wl=_("Filter"),Jl=_("All"),Kl=_("Pending"),Xl=_("Approved"),Zl=_("Declined"),et=_("Partial"),lt=["onClick"],tt=_(" Approve giftcard "),at=_(" Partial approval "),ot=_(" Decline giftcard "),st={key:1,class:"font-weight-bold text-center my-3"},nt={class:"mb-3 d-flex justify-space-between"},rt=o("h3",{class:"text-justify mt-7"},"Partial approval",-1),ut=o("label",{for:"proof",class:"cursor-pointer"},[o("p",{class:"text-black"},"Upload transaction proof")],-1),dt={key:0,for:"proof",class:"cursor-pointer"},it=o("img",{src:ye,alt:"card-placeholder",class:"mt-3 w-full object-fill max-h-[174px] rounded-xl"},null,-1),ct=[it],pt={class:"gap-5 mt-5",style:{display:"grid","grid-template-columns":"repeat(4, 80px)",gap:"12px"}},_t={style:{position:"relative"}},ft=["src"],vt=["onClick"],gt={key:1,class:"pt-3 text-center"},ht={class:"p-2 block"},yt={key:2,for:"proof",class:"mt-4 d-flex align-center cursor-pointer"},mt=o("img",{src:me,alt:"plus icon"},null,-1),bt=o("p",{class:"ml-3 underline"},"Add more proof",-1),xt=[mt,bt],kt=_("submit"),wt=o("h3",null,"Decline Request",-1),Vt=o("p",null,"Enter Reasons for Declining this withdrawal request",-1),Ct=o("label",{for:"proof",class:"cursor-pointer"},[o("p",{class:"text-black"},"Upload transaction proof")],-1),Tt={key:0,for:"proof",class:"cursor-pointer"},At=o("img",{src:ye,alt:"card-placeholder",class:"mt-3 w-full object-fill max-h-[174px] rounded-xl"},null,-1),Ut=[At],Dt={class:"gap-5 mt-5",style:{display:"grid","grid-template-columns":"repeat(4, 80px)",gap:"12px"}},Ft={style:{position:"relative"}},jt=["src"],It=["onClick"],Pt={key:1,class:"pt-3 text-center"},Rt={class:"p-2 block"},$t={key:2,for:"proof",class:"mt-4 d-flex align-center cursor-pointer"},Nt=o("img",{src:me,alt:"plus icon"},null,-1),St=o("p",{class:"ml-3 underline"},"Add more proof",-1),Et=[Nt,St],Gt=_("Submit"),Kt=qe({__name:"transaction",setup(Bt){const{getAllGiftCardTransaction:y,declineRequest:be,approveRequest:xe,getAllGiftCardTransactionByUserId:qt,partialApproveRequest:ke,giftCardTransactionQueries:Lt,exportGiftcards:we}=ge(),{getAllTransactionCount:Ve}=he(),{permissions:Ce}=se(Le()),{giftcard_total:x}=se(he());let q=p(!1),N=p(1),Y=p(1);const{gift_transactions:S,loading:ee,singleGiftCardTransaction:zt,declining:Te,approving:Ae,dialog:j,dialog2:E,page:U,tab:le,status:g}=se(ge()),G=r=>new Intl.NumberFormat().format(r),te=p("");p("");function Ue(){C.value=""}const ae=p([]),De=r=>{q.value=!0;let e=r.length,f=0;if(event){for(Y.value=r.length;e--;)fe(r[f]).then(T=>{N.value++,h.value.push(T.secure_url),ae.value.push(T.secure_url)}),f++;N.value=0}},I=ze({review_amount:"",review_note:"",review_proof:[]}),Fe=(r,e)=>{h.value=h.value.filter(f=>f!==r),I.review_proof.splice(e,1)},je=(r,e)=>{h.value=h.value.filter(f=>f!==r),ae.value.splice(e,1)},h=p([]),Ie=r=>{q.value=!0;let e=r.length;console.log(r);let f=0;if(event){for(Y.value=r.length;e--;)fe(r[f]).then(T=>{N.value++,h.value.push(T.secure_url),I.review_proof.push(T.secure_url)}),f++;N.value=0}},Pe=p([{title:"No."},{title:"User name"},{title:"Category"},{title:"Reference No."},{title:"Trade Type."},{title:"Amount"},{title:"Date"},{title:"Status"},{title:"Actions"}]);p([{text:"Cards",disabled:!1,href:"#"},{text:"Transactions",disabled:!0,href:"#"}]);const Re=r=>r=="pending"?"yellow-darken-3":r=="approved"?"green lighten-3":r=="declined"?"red lighten-3":r=="partially_approved"?"purple lighten-3":"";p(["Pending","Approved","Declined","Partially_approved"]);const k=p(""),$e=p(["Buy","Sell"]),w=p(""),V=p(""),C=p(""),Ne=r=>r==="partially_approved"?"Partial":r,Se=async()=>{g.value="",k.value="",U.value=1,w.value="",V.value="",await y(g.value,k.value,U.value,w.value,V.value,C.value)};p(null),Me(async()=>{await Ve(),await y(g.value,k.value,U.value,w.value,V.value,C.value)});var re=new Pusher("2bd4bb8b30b7085ba28d",{cluster:"mt1"}),Ee=re.subscribe("giftcards");Ee.bind("new-giftcard",function(r){var e;console.log(r),S.value&&((e=S.value)==null||e.data.unshift(r==null?void 0:r.giftcard))}),Ye(()=>{re.unsubscribe("giftcards")});const ue=async()=>{await y(g.value,k.value,U.value,w.value,V.value,C.value),h.value=[],q.value=!1},D=p(!1);let m=p("");const O=p(""),oe=(r,e)=>{D.value=!0,m.value=e,O.value=r},Ge=async r=>{r=="approve"?(await xe(m.value),ue(),D.value=!1):r=="decline"?(be(m.value,te.value,ae.value),D.value=!1):r=="partial"&&(ke(m.value,I),D.value=!1),D.value=!1};return Oe([j,E],([r,e],[f,T])=>{r===!1&&e===!1&&ue()}),(r,e)=>{var T;const f=ul("vue-feather");return u(),d(M,null,[l(ne,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=n=>D.value=n),width:"500"},{default:t(()=>[l(R,null,{default:t(()=>[l(He,{dark:"",dense:"",flat:""},{default:t(()=>[l(Qe,{class:"text-body-2 font-weight-bold grey--text"},{default:t(()=>[fl]),_:1})]),_:1}),l(pe,{class:"pa-4 black--text"},{default:t(()=>[_("Are you sure you want to "+i(O.value==="partial"?"partially approve":O.value)+" this transaction?",1)]),_:1}),l(We,{class:"pt-3"},{default:t(()=>[l(Je),l(A,{color:"grey",text:"",class:"body-2 font-weight-bold",onClick:e[0]||(e[0]=n=>D.value=!1)},{default:t(()=>[vl]),_:1}),l(A,{color:"primary",class:"body-2 font-weight-bold",outlined:"",onClick:e[1]||(e[1]=n=>Ge(O.value))},{default:t(()=>[gl]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o("div",hl,[yl,l(A,{onClick:s(we),width:"200px",color:"secondary"},{default:t(()=>[ml]),_:1},8,["onClick"])]),((T=s(Ce))==null?void 0:T.length)==18?(u(),F(W,{key:0,class:"my-3"},{default:t(()=>[l($,{cols:"12",sm:"6",md:"4"},{default:t(()=>[l(R,{elevation:"0",class:"pa-6 h-100"},{default:t(()=>{var n;return[bl,((n=s(x))==null?void 0:n.length)>0?(u(),d("div",xl,[o("h2",kl," \u20A6\u200E"+i(G(s(x)[0].total_approved_transactions_amount)),1),wl])):(u(),d("p",Vl,"loading..."))]}),_:1})]),_:1}),l($,{cols:"12",sm:"6",md:"8"},{default:t(()=>[l(R,{elevation:"0",class:"py-4 px-2"},{default:t(()=>{var n,c,P,b;return[o("div",Cl,[o("div",Tl,[l(Q,{color:"#e5fafb",size:"x-large"},{default:t(()=>[l(f,{type:"check-circle",class:"text-dark text-success"})]),_:1}),((n=s(x))==null?void 0:n.length)>0?(u(),d("div",Al,[o("h2",Ul,i(G(s(x)[0].total_approved_transactions_count)),1),Dl])):(u(),d("p",Fl,"loading..."))]),o("div",jl,[l(Q,{color:"#FFF9C4",size:"x-large"},{default:t(()=>[l(f,{type:"bar-chart",class:"text-dark text-primary"})]),_:1}),((c=s(x))==null?void 0:c.length)>0?(u(),d("div",Il,[o("h2",Pl,i(G(s(x)[0].total_pending_transactions_count)),1),Rl])):(u(),d("p",$l,"loading..."))]),o("div",Nl,[l(Q,{color:"#FFCCBC",size:"x-large"},{default:t(()=>[l(f,{type:"x-circle",class:"text-dark text-error"})]),_:1}),((P=s(x))==null?void 0:P.length)>0?(u(),d("div",Sl,[o("h2",El,i(G(s(x)[0].total_declined_transactions_count)),1),Gl])):(u(),d("p",Bl,"loading..."))]),o("div",ql,[l(Q,{color:"purple",size:"x-large"},{default:t(()=>[l(f,{type:"check",class:"purple-lighten-1"})]),_:1}),((b=s(x))==null?void 0:b.length)>0?(u(),d("div",Ll,[o("h2",zl,i(G(s(x)[0].total_partially_approved_transactions_count)),1),Ml])):(u(),d("p",Yl,"loading..."))])])]}),_:1})]),_:1})]),_:1})):v("",!0),l(R,{flat:"",elevation:"0",rounded:"0",class:"my-5 pa-4"},{default:t(()=>[o("div",Ol,[Hl,o("div",null,[l(A,{onClick:Se,width:"200px",class:"mr-4"},{default:t(()=>[Ql]),_:1}),l(A,{onClick:e[3]||(e[3]=n=>s(y)(s(g),k.value,s(U),w.value,V.value,C.value)),width:"200px",color:"secondary"},{default:t(()=>[Wl]),_:1})])]),l(W,{class:"mt-3"},{default:t(()=>[l($,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l(J,{label:"Filter by Reference",modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=n=>C.value=n),density:"compact",variant:"outlined","onClick:clear":Ue,clearable:""},null,8,["modelValue"])]),_:1}),l($,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l(Ke,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=n=>k.value=n),label:"Filter by trade type",density:"compact",items:$e.value,variant:"outlined"},null,8,["modelValue","items"])]),_:1}),l($,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l(J,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=n=>w.value=n),label:"Filter date from",density:"compact",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),l($,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l(J,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=n=>V.value=n),type:"date",label:"Filter date to",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(W,null,{default:t(()=>[l($,{cols:"12",sm:"12",class:"mt-4"},{default:t(()=>{var n;return[l(R,{class:"pa-5"},{default:t(()=>{var c,P;return[l(Xe,{modelValue:s(le),"onUpdate:modelValue":e[13]||(e[13]=b=>B(le)?le.value=b:null),"bg-color":"none",class:"mb-5 border-bottom"},{default:t(()=>[l(z,{onClick:e[8]||(e[8]=b=>s(y)(g.value=""))},{default:t(()=>[Jl]),_:1}),l(z,{onClick:e[9]||(e[9]=b=>s(y)(g.value="pending"))},{default:t(()=>[Kl]),_:1}),l(z,{onClick:e[10]||(e[10]=b=>s(y)(g.value="approved"))},{default:t(()=>[Xl]),_:1}),l(z,{onClick:e[11]||(e[11]=b=>s(y)(g.value="declined"))},{default:t(()=>[Zl]),_:1}),l(z,{onClick:e[12]||(e[12]=b=>s(y)(g.value="partial"))},{default:t(()=>[et]),_:1})]),_:1},8,["modelValue"]),l(Ze,null,{default:t(()=>{var b,de;return[o("thead",null,[o("tr",null,[(u(!0),d(M,null,K(Pe.value,(H,a)=>(u(),d("th",{key:a,class:"text-left"},i(H.title),1))),128))])]),((de=(b=s(S))==null?void 0:b.data)==null?void 0:de.length)>0&&s(ee)==!1?(u(),F(el,{key:0,name:"list",tag:"tbody"},{default:t(()=>{var H;return[(u(!0),d(M,null,K((H=s(S))==null?void 0:H.data,(a,Be)=>{var ie,ce;return u(),d("tr",{key:a.id},[o("td",null,i(Be+1),1),o("td",{class:"font-weight-bold username",onClick:L=>r.$router.push({name:"UserDetails",params:{id:a==null?void 0:a.user_id}})},i(a.user.firstname)+" "+i(a.user.lastname),9,lt),o("td",null,i((ce=(ie=a==null?void 0:a.giftcard_product)==null?void 0:ie.giftcard_category)==null?void 0:ce.name),1),o("td",null,i(a.reference),1),o("td",null,i(a.trade_type),1),o("td",null," \u20A6\u200E "+i(G(a.payable_amount*(a.children_count&&a.children_count!==0?a.children_count+1:1))),1),o("td",null,i(s(_l)(a==null?void 0:a.created_at,"DD-MM-YYYY hh:mm a").value),1),o("td",null,[l(dl,{label:"",size:"small",class:"text-capitalize font-weight-bold pa-3",color:Re(a==null?void 0:a.status)},{default:t(()=>[_(i(Ne(a==null?void 0:a.status)),1)]),_:2},1032,["color"])]),o("td",null,[l(W,{justify:"center"},{default:t(()=>[l(il,{transition:"scroll-y-transition"},{activator:t(({props:L})=>[l(A,cl({text:"",icon:"mdi-dots-vertical",color:"transparent",class:"ma-2"},L),null,16)]),default:t(()=>[l(pl,null,{default:t(()=>[l(X,{to:{name:a.children_count&&a.children_count>0?"RelatedGiftCards":"ViewGiftCardTransaction",params:{id:a.id}},link:"",color:"secondary"},{default:t(()=>[l(Z,null,{default:t(()=>[_(i(a.children_count&&a.children_count>0?"View List":"View giftcard"),1)]),_:2},1024)]),_:2},1032,["to"]),(a==null?void 0:a.status)=="pending"&&(a==null?void 0:a.children_count)==0?(u(),F(X,{key:0,onClick:L=>oe("approve",a==null?void 0:a.id),link:"",color:"secondary"},{default:t(()=>[l(Z,null,{default:t(()=>[tt]),_:1})]),_:2},1032,["onClick"])):v("",!0),(a==null?void 0:a.status)=="pending"&&a.children_count==0?(u(),F(X,{key:1,onClick:L=>(j.value=!0,B(m)?m.value=a==null?void 0:a.id:m=a==null?void 0:a.id),link:"",color:"secondary"},{default:t(()=>[l(Z,null,{default:t(()=>[at]),_:1})]),_:2},1032,["onClick"])):v("",!0),(a==null?void 0:a.status)=="pending"&&a.children_count==0?(u(),F(X,{key:2,onClick:L=>(E.value=!0,B(m)?m.value=a==null?void 0:a.id:m=a==null?void 0:a.id),link:"",color:"secondary"},{default:t(()=>[l(Z,null,{default:t(()=>[ot]),_:1})]),_:2},1032,["onClick"])):v("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])])}),128))]}),_:1})):v("",!0)]}),_:1}),s(ee)==!0?(u(),F(tl,{key:0,class:"align-center justify-center w-100 my-5"},{default:t(()=>[l(ll,{indeterminate:""})]),_:1})):v("",!0),((P=(c=s(S))==null?void 0:c.data)==null?void 0:P.length)<=0&&s(ee)==!1?(u(),d("p",st," No data found ")):v("",!0)]}),_:1}),l(al,{modelValue:s(U),"onUpdate:modelValue":[e[14]||(e[14]=c=>B(U)?U.value=c:null),e[17]||(e[17]=(...c)=>s(y)(s(g),k.value,...c,w.value,V.value,C.value))],length:(n=s(S))==null?void 0:n.last_page,onNext:e[15]||(e[15]=(...c)=>s(y)(s(g),k.value,...c,w.value,V.value,C.value)),onPrev:e[16]||(e[16]=(...c)=>s(y)(s(g),k.value,...c,w.value,V.value,C.value)),"active-color":"red",start:1,variant:"flat",class:"mt-5",color:"bg-secondary",rounded:"circle"},null,8,["modelValue","length"])]}),_:1}),s(j)?(u(),F(ne,{key:0,modelValue:s(j),"onUpdate:modelValue":e[23]||(e[23]=n=>B(j)?j.value=n:null),"max-width":"429px","min-height":"476px"},{default:t(()=>[l(R,{class:"view-dialog pa-4"},{default:t(()=>[o("div",nt,[rt,l(A,{onClick:e[18]||(e[18]=n=>j.value=!1),icon:"mdi-close",color:"secondary",variant:"text"},{default:t(()=>[l(ol,{icon:"mdi-close"})]),_:1})]),l(sl,{class:"my-10"},{default:t(()=>[l(J,{prefix:"\u20A6\u200E",modelValue:I.review_amount,"onUpdate:modelValue":e[19]||(e[19]=n=>I.review_amount=n),type:"number",variant:"outlined",label:"Review Amount"},null,8,["modelValue"]),l(_e,{modelValue:I.review_note,"onUpdate:modelValue":e[20]||(e[20]=n=>I.review_note=n),variant:"outlined",label:"Review Note"},null,8,["modelValue"]),ut,h.value.length?v("",!0):(u(),d("label",dt,ct)),o("input",{type:"file",multiple:"",id:"proof",ref:"fileInput",style:{display:"none"},accept:"image/*",onChange:e[21]||(e[21]=n=>Ie(n.target.files))},null,544),o("div",pt,[(u(!0),d(M,null,K(h.value,(n,c)=>(u(),d("div",{key:c},[o("div",_t,[o("img",{class:"w-full cursor-pointer",style:{height:"75px","object-fit":"cover",width:"100%"},src:n},null,8,ft),o("img",{src:ve,class:"absolute rounded-full border border-red-700 -top-2 -right-2 bg-red-200 text-red-500 cursor-pointer",style:{position:"absolute",right:"-5px",top:"-5px"},width:"20",onClick:P=>Fe(n,c)},null,8,vt)])]))),128))]),s(q)?(u(),d("div",gt,[o("small",ht,"Uploaded "+i(s(N))+" of "+i(s(Y))+"...",1)])):v("",!0),h.value.length?(u(),d("label",yt,xt)):v("",!0),l(A,{loading:s(Ae),onClick:e[22]||(e[22]=n=>oe("partial",s(m))),class:"mt-5",block:"",color:"secondary"},{default:t(()=>[kt]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):v("",!0),l(nl,null,{default:t(()=>[s(E)?(u(),F(ne,{key:0,modelValue:s(E),"onUpdate:modelValue":e[27]||(e[27]=n=>B(E)?E.value=n:null),"max-width":"500px",width:"100%"},{default:t(()=>[l(R,{"max-width":"500px"},{default:t(()=>[l(pe,null,{default:t(()=>[wt,Vt]),_:1}),l(rl,{class:"mt-7"},{default:t(()=>[l(_e,{label:"Comments",modelValue:te.value,"onUpdate:modelValue":e[24]||(e[24]=n=>te.value=n),variant:"outlined"},null,8,["modelValue"]),Ct,h.value.length?v("",!0):(u(),d("label",Tt,Ut)),o("input",{type:"file",multiple:"",id:"proof",ref:"fileInput",style:{display:"none"},accept:"image/*",onChange:e[25]||(e[25]=n=>De(n.target.files))},null,544),o("div",Dt,[(u(!0),d(M,null,K(h.value,(n,c)=>(u(),d("div",{key:c},[o("div",Ft,[o("img",{class:"w-full cursor-pointer",style:{height:"75px","object-fit":"cover",width:"100%"},src:n},null,8,jt),o("img",{src:ve,class:"absolute rounded-full border border-red-700 -top-2 -right-2 bg-red-200 text-red-500 cursor-pointer",style:{position:"absolute",right:"-5px",top:"-5px"},width:"20",onClick:P=>je(n,c)},null,8,It)])]))),128))]),s(q)?(u(),d("div",Pt,[o("small",Rt,"Uploaded "+i(s(N))+" of "+i(s(Y))+"...",1)])):v("",!0),h.value.length?(u(),d("label",$t,Et)):v("",!0),l(A,{color:"secondary",class:"my-5",block:"",loading:s(Te),onClick:e[26]||(e[26]=n=>oe("decline",s(m)))},{default:t(()=>[Gt]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):v("",!0)]),_:1})]),_:1})],64)}}});export{Kt as default};
