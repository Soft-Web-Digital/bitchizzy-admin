import{d as p,f as r,Y as i,aI as d,aJ as h,a0 as n}from"./index.d08b3963.js";import{d as u}from"./filedownloader.f3cc1d55.js";import{u as g}from"./country.cb4beb97.js";const A=p("user",{state:()=>({user:[],users:[],admin:[],loading:!1,dialog:!1,dialog2:!1,use_activity:{},fund:{type:"",amount:""},adminDetails:{firstname:"",lastname:"",email:"",country:""},id:"",single_admin:"",single_user:"",bank_info:[],banks:[],search_users:[],referrals:[]}),getters:{filterUserById:a=>e=>{var t,s;return(s=(t=a.user)==null?void 0:t.data)==null?void 0:s.filter(o=>o.id==e)},getUsersByEmailAndId:a=>{var e,t;return(t=(e=a.user)==null?void 0:e.data)==null?void 0:t.map(s=>({email:s.email,id:s.id}))},country_id(){return g().countries.filter(e=>{if(e.name===this.adminDetails.country_name)return e})},toggleActivationText:a=>{var e;return(e=a.single_admin)!=null&&e.blocked_at?"restore access":"block"}},actions:{updateAdmin(){return this.adminDetails={...this.admin.filter(a=>a.id==this.id)}},async getUsers(a=1,e="",t="",s="",o=""){const c=r();this.loading=!0;try{await i.get(`${d}?filter[name]=${e}&filter[email]=${t}&filter[registration_date]=${s}${o!==""?`,${o}`:""}&page=${a}&per_page=100`,{headers:{Accept:"application/json",Authorization:`Bearer ${c.token}`}}).then(l=>{this.loading=!1,this.use_activity=l.data.data,this.user=l.data.data.users})}catch{this.loading=!1}},async getAllReferralsByUserID(a){console.log("here");const e=r();this.loading=!0;try{await i.get("admin/referrals?include=referred&filter[user_id]="+a,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(t=>{this.loading=!1,this.referrals=t.data.data.referrals})}catch(t){this.loading=!1,console.log(t)}},async searchUsers(a=""){const e=r();this.loading=!0;try{await i.get(`${d}?filter[email]=${a}`,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(t=>{this.loading=!1,this.search_users=t.data.data.users.data})}catch{this.loading=!1}},async getUser(a){const e=r();this.loading=!0;try{await i.get(`/admin/users/${a}`,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(t=>{this.loading=!1,this.single_user=t.data.data.user})}catch{this.loading=!1}},async getAdmin(){const a=r(),{notify:e}=n();this.loading=!0;try{await i.get(`${h}?include=roles,country`,{headers:{Accept:"application/json",Authorization:`Bearer ${a.token}`}}).then(t=>{this.loading=!1,this.admin=t.data.data.admins.data})}catch(t){this.loading=!1,e({title:"An Error Occurred",text:t.response.data.message,type:"error"})}},async getSingleAdmin(a){const e=r();this.dialog2=!0,this.loading=!0;try{await i.get(h+"/"+a+"?include=country,roles,giftcardCategories",{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(t=>{this.loading=!1,this.single_admin=t.data.data.admin})}catch{this.loading=!1}},async blockUsers(a){const e=r(),{notify:t}=n();this.loading=!0;try{await i.patch(d+"/"+a+"/block","",{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(s=>{this.loading=!1,t({title:"Successful",text:s.data.message,type:"success"}),this.getUsers(1,"","","","")})}catch{this.loading=!1}},async restoreUsers(a){const e=r(),{notify:t}=n();this.loading=!0;try{await i.post(d+a+"/block","",{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(s=>{this.loading=!1,t({title:"Successful",text:s.data.message,type:"success"}),this.getUsers(1,"","","","")})}catch{this.loading=!1}},async financeUsers(a,e){const t=r(),{notify:s}=n();this.loading=!0;const o=new FormData;o.append("amount",e.amount);try{await i.post(d+"/"+a+"/finance/"+e.type.toLocaleLowerCase(),o,{headers:{Accept:"application/json",Authorization:`Bearer ${t.token}`}}).then(c=>{this.loading=!1,this.dialog2=!1,s({title:"Success",text:c.data.message,type:"success"}),this.getUsers(1,"","","","")})}catch(c){this.loading=!1,s({title:"An Error Occurred",text:c.response.data.message,type:"error"})}},async CreateAdmin(){const a=r(),{notify:e}=n();this.loading=!0;const t=new FormData;t.append("country_id",this.adminDetails.country),t.append("firstname",this.adminDetails.firstname),t.append("lastname",this.adminDetails.lastname),t.append("email",this.adminDetails.email);try{await i.post(h,t,{headers:{Accept:"application/json",Authorization:`Bearer ${a.token}`}}).then(s=>{this.loading=!1,e({title:"Success",text:s.data.message,type:"success"}),this.dialog=!1,this.getAdmin()})}catch(s){this.loading=!1,e({title:"An Error Occurred",text:s.response.data.message,type:"error"})}},async updateAdminDetails(a){const e=r(),{notify:t}=n();this.loading=!0;const s=new FormData;s.append("country_id",this.adminDetails.country),s.append("firstname",this.adminDetails.firstname),s.append("lastname",this.adminDetails.lastname),s.append("email",this.adminDetails.email),s.append("_method","PATCH");try{await i.post(h+"/"+a,s,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(o=>{this.loading=!1,t({title:"Success",text:o.data.message,type:"success"}),this.dialog=!1,this.getAdmin()})}catch(o){this.loading=!1,t({title:"An Error Occurred",text:o.response.data.message,type:"error"})}},async deleteAdmin(a){if(confirm("Are you sure you want to delete this admin user?")){const{notify:e}=n(),t=r();try{await i.delete(h+"/"+a,{headers:{Accept:"application/json",Authorization:`Bearer ${t.token}`}}).then(s=>{e({title:"Success",text:"Admin deleted successfully",type:"success"}),this.getAdmin()})}catch(s){e({title:"An Error Occurred",text:s.response.data.message,type:"error"})}}},async restoreAdmin(a){if(confirm("Are you sure you want to restore access to this admin?")){const{notify:e}=n(),t=r();try{await i.patch(h+"/"+a+"/restore","",{headers:{Accept:"application/json",Authorization:`Bearer ${t.token}`}}).then(s=>{e({title:"Successful",text:s.data.message,type:"success"}),this.getAdmin()})}catch(s){e({title:"An Error Occurred",text:s.response.data.message,type:"error"})}}},async blockAdmin(a){if(confirm(`Are you sure you want to ${this.toggleActivationText} this admin ?`)){const{notify:e}=n(),t=r();try{await i.patch(h+"/"+a+"/block","",{headers:{Accept:"application/json",Authorization:`Bearer ${t.token}`}}).then(s=>{e({title:"Successful",text:s.data.message,type:"success"}),this.getAdmin(),this.dialog2=!1})}catch(s){e({title:"An Error Occurred",text:s.response.data.message,type:"error"})}}},async getSystemBanks(a){const e=r();this.loading=!0;try{await i.get("/admin/system-bank-accounts",{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(t=>{this.loading=!1,console.log(t),this.bank_info=t.data.data})}catch{this.loading=!1}},async deleteSystemBanks(a){const e=r();if(confirm("Are you sure you want to delete this record?")){this.loading=!0;try{await i.delete(`/admin/system-bank-accounts/${a}`,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(t=>{this.loading=!1,this.getSystemBanks(1)})}catch{this.loading=!1}}else return},async createSystemBanks(a){const e=r();this.loading=!0;try{await i.post("/admin/system-bank-accounts",a,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(t=>{this.loading=!1,this.dialog2=!1,this.getSystemBanks(1)})}catch{this.loading=!1}},async updateSystemBanks(a){const e=r();this.loading=!0;const t=new FormData;t.append("bank_name",a.bank_name),t.append("account_number",a.account_number),t.append("account_name",a.account_name),t.append("_method","PUT");try{await i.post(`/admin/system-bank-accounts/${a.id}`,t,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(s=>{this.loading=!1,this.dialog2=!1,this.getSystemBanks(1)})}catch{this.loading=!1}},async getBanks(){const a=r();this.loading=!0;try{await i.get(`/banks?do_not_paginate=${1}`,{headers:{Accept:"application/json",Authorization:`Bearer ${a.token}`}}).then(e=>{this.loading=!1,this.banks=e.data.data.banks})}catch{this.loading=!1}},async exportUsers(){var c;let e=0,t=Math.ceil(((c=this.user)==null?void 0:c.total)/5e3);const s=r(),{notify:o}=n();o({title:"Export",text:"Preparing file to export",type:"info"});try{for(;t--;)await i.get(d+`/export?limit=${5e3}&offset=${e}`,{headers:{Accept:"application/json",Authorization:`Bearer ${s.token}`}}).then(l=>{u(l.data.data.path,"file downloaded")}),e++;o({title:"Successful",text:"Users exported successfully",type:"success"})}catch(l){this.loading=!1,o({title:"An Error Occurred",text:l.response.data.message,type:"error"})}},async blockUser(a){const e=r(),{notify:t}=n();this.loading=!0;try{await i.patch(`${d}/${a}/block`,{headers:{Accept:"application/json",Authorization:`Bearer ${e.token}`}}).then(s=>{this.loading=!1,t({title:"Successful",text:s.data.message,type:"success"})})}catch(s){this.loading=!1,t({title:"An Error Occurred",text:s.response.data.message,type:"error"})}}}});export{A as u};
